name = 'Amber'
local_amber_ver = 22
local_ambertools_ver = 22
# Patch levels from http://ambermd.org/AmberPatches.php and http://ambermd.org/ATPatches.php
patchlevels = (3, 0)  # (AmberTools, Amber)
version = '%s.%s' % (local_amber_ver, patchlevels[1])
versionsuffix = '-AmberTools-%s.%s' % (local_ambertools_ver, patchlevels[0])

homepage = 'http://ambermd.org/amber.html'
description = """Amber (originally Assisted Model Building with Energy Refinement) is software for performing
 molecular dynamics and structure prediction."""

toolchain = {'name': 'foss', 'version': '2021b'}
toolchainopts = {'usempi': True, 'openmp': True}

sources = [
    '%%(name)s%s.tar.bz2' % local_amber_ver,
    'AmberTools-%s.tar.bz2' % local_ambertools_ver,
]
patches = [
    'Amber-22_remove_undeclared_redundant_variable.patch',
    'AmberTools-20_cmake-locate-netcdf.patch',
    'AmberTools-20_fix_missing_MPI_LIBRARY_error.patch',
    'AmberTools-20_fix_xblas_missing_make_dependency.patch',
    'AmberTools-21_CMake-FlexiBLAS.patch',
    'AmberTools-22_fix_cuda_version_check.patch',
]
checksums = [
    '3c887ccbad690fc76ff0b120a3448eae023c08e76582aac07900d4a9708ebd16',  # Amber22.tar.bz2
    '1571d4e0f7d45b2a71dce5999fa875aea8c90ee219eb218d7916bf30ea229121',  # AmberTools-22.tar.bz2
    # Amber-22_remove_undeclared_redundant_variable.patch
    'f2e21002e00534f14caa00bc5bbf3b1e68acb71aa8dbcfea275d67192e32c15f',
    '473e07c53b6f641d96d333974a6af2e03413fecef79f879d3fdecf7fecaab4d0',  # AmberTools-20_cmake-locate-netcdf.patch
    # AmberTools-20_fix_missing_MPI_LIBRARY_error.patch
    '185040c79c8799d4f2d75139b7c648a1863f3484c4e1baab3470d2cf8d660b65',
    # AmberTools-20_fix_xblas_missing_make_dependency.patch
    'ff25e91fdc72347a778c3837b581e174d6a8c71efa5b46e11391b18bca84fd65',
    '9543812c24c4b7842f64f1f8abaf2c92b5c4c0fadcdbd9811e76b81a778f0d36',  # AmberTools-21_CMake-FlexiBLAS.patch
    '3fc08a2cf61f3eefd094554e60c88b14c9f5071f94e0a0a15c6b55fe321bfc78',  # AmberTools-22_fix_cuda_version_check.patch
]

builddependencies = [
    ('Bison', '3.7.6'),
    ('pkg-config', '0.29.2'),
    ('CMake', '3.22.1'),
    ('flex', '2.6.4'),
    ('make', '4.3'),
]

dependencies = [
    ('zlib', '1.2.11'),
    ('bzip2', '1.0.8'),
    ('Python', '3.9.6'),
    ('SciPy-bundle', '2021.10'),  # mpi4py required for MMPBSA
    ('Perl', '5.34.0'),
    ('Boost', '1.77.0'),
    ('libreadline', '8.1'),
    ('matplotlib', '3.4.3'),
    ('netCDF', '4.8.1'),
    ('netCDF-Fortran', '4.5.3'),
    ('PnetCDF', '1.12.3'),
    ('arpack-ng', '3.8.0'),
    ('Tkinter', '3.9.6'),
    ('X11', '20210802'),
    ('CUDA', '11.4.1', '', True),
    ('NCCL', '2.10.3', '-CUDA-%(cudaver)s'),
]

# Some CUDA tests differs from expected results
runtest = False

static = False

moduleclass = 'chem'
